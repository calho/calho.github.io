let hockeyApi=new HockeyAPI,data=[],savedData=[],savedYears=[];function initiatePage(){fillTeamSelector(!0)}function fillTeamSelector(e=!1){hockeyApi.getTeams(e),fillPlayerSelector(e)}function clearCurrentPosition(){savedData=[],data=[],savedYears=[];let e=document.getElementById("compares");for(;e.firstChild;)e.removeChild(e.firstChild);fillPlayerSelector()}function fillPlayerSelector(e=!1){let t=document.getElementById("teamSelector");document.getElementById("playerSelector").options.length=0;let a=document.getElementById("positionSelector");hockeyApi.getRoster(t.options[t.selectedIndex].value,a.options[a.selectedIndex].value,e),e?fillStatSelector():createGraph()}function fillStatSelector(){let e,t=document.getElementById("playerSelector");for(;;){let a=t.options[t.selectedIndex],o=new JsonResponse;hockeyApi.getPlayerStats(a.value,o);let n=o.response.splits;if((e=findNHLLeague(n)).hasOwnProperty("stat"))break}let a=document.getElementById("statSelector");if(a.options.length=0,e.hasOwnProperty("stat")){let t={};Object.keys(e.stat).sort().forEach(function(a){t[a]=e.stat[a]});for(let e in t){let t=document.createElement("option");t.value=e,t.textContent=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Z])([A-Z])/g,"$1 $2").trim(),"points"===e&&(t.selected=!0),"savePercentage"===e&&(t.selected=!0),a.appendChild(t)}}createGraph()}function checkNHLLeague(e){return e.league.hasOwnProperty("id")&&e.league.id===hockeyApi.getNHLId()}function findNHLLeague(e){return e.find(checkNHLLeague)}function getNewStats(){let e=document.getElementById("statSelector"),t=e.options[e.selectedIndex].value,a=e.options[e.selectedIndex].text,o=document.getElementById("positionSelector"),n=0===o.options[o.selectedIndex].value.localeCompare("2")?"G":"S";savedData.forEach(function(e){let o=new JsonResponse,l=createStatsData(e.id,o,n,a,t);e.y=l.season_stats,e.text=l.stat_description}),createGraph()}function createGraph(){let e=document.getElementById("playerSelector"),t=new JsonResponse,a={},o="",n=e.options[e.selectedIndex],l=!1;document.getElementById("compares").childNodes.forEach(function(e){0===e.id.localeCompare(n.value)&&(l=!0)});let s=document.getElementById("positionSelector"),r=0===s.options[s.selectedIndex].value.localeCompare("2")?"G":"S",i=document.getElementById("statSelector"),c=i.options[i.selectedIndex].value,d=i.options[i.selectedIndex].text;if(l)o=0===r.localeCompare("G")?d:d+" Per Game",data=[];else{let e={x:(a=createStatsData(n.value,t,r,d,c)).season_year,y:a.season_stats,text:a.stat_description,name:n.text,type:"scatter",id:n.value};o=a.yaxis,data=[e]}let u=Plotly.d3;document.getElementById("graph").remove();let p=u.select("#selectors").append("div").style({width:"60%","margin-left":"20%",height:"80vh","margin-top":"10vh"}).attr("id","graph").node(),m=savedData.concat(data),f={showlegend:!0,legend:{x:100,y:1},xaxis:{title:"Season",titlefont:{family:"Courier New, monospace",size:18,color:"#7f7f7f"},categoryorder:"array",categoryarray:getStringAxisValues(a.season_year,"x")},yaxis:{title:o,titlefont:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}};Plotly.newPlot(p,m,f),window.onresize=function(){Plotly.Plots.resize(p)}}function createStatsData(e,t,a,o,n){let l=[],s=[],r=[],i="",c=!1;hockeyApi.getPlayerStats(e,t);let d=t.response.splits;0===a.localeCompare("G")?(d.forEach(function(e){if(e.league.hasOwnProperty("id")&&e.league.id===hockeyApi.getNHLId()){let t=e.stat[n];l.push(t);let a=e.season;s.push(a.substring(0,4)+"-"+a.substring(4)),"string"==typeof t&&(c=!0),r.push(e.team.name)}}),i=o):(d.forEach(function(e){if(e.league.hasOwnProperty("id")&&e.league.id===hockeyApi.getNHLId()){let t=e.stat[n],a=e.stat.games,i=new RegExp(/^\d*:\d*$/);if("string"==typeof t&&i.test(t)){let e=i.exec(t);if(0===e[0].localeCompare(e.input)){let e=t.split(":"),o=Number(e[0])/a,n=Math.floor(o),s=Math.round(((o-n)*a*60+Number(e[1]))/a);l.push(n+s/100),c=!0}}else l.push(t/a);let d=e.season;s.push(d.substring(0,4)+"-"+d.substring(4)),r.push(e.stat[n]+" "+o+" in "+e.stat.games+" games </br>"+e.team.name)}}),i=o+" Per Game");let u=getStringAxisValues(s,"x"),p=getStringAxisValues(l,"y");return{season_stats:l,season_year:s,stat_description:r,yaxis:i,xValues:u,yValues:p}}function addToCompare(){let e=document.getElementById("compares"),t=!1,a=document.getElementById("playerSelector"),o=a.options[a.selectedIndex];if(e.childNodes.forEach(function(e){0===e.id.localeCompare(o.value)&&(t=!0)}),!1===t){let t=document.createElement("button");t.className="badge badge-pill badge-light mt-2",t.textContent="x "+o.text,t.id=o.value,t.onclick=function(){removeFromCompare(this)},e.appendChild(t),savedData.push(data[0]),savedYears=savedYears.concat(data[0].x)}}function removeFromCompare(e){e.parentNode.removeChild(e),savedData=savedData.filter(findPlayer,e.id),createGraph()}function getStringAxisValues(e,t){let a=[];return savedData.forEach(function(e){console.log(e[t]),a=a.concat(e[t])}),sortNuniq(a.concat(e))}function sortNuniq(e){return e.sort().filter(function(e,t,a){return!t||e!=a[t-1]})}function findPlayer(e){return e.id.localeCompare(this)}